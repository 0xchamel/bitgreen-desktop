<div mat-dialog-title>
  {{data?.listing?.title}}
  <span class="category">
    in {{data?.listing?.category.name}}
  </span>
</div>

<button class="small-close_button pull-right" (click)="dialogClose()">
  <mat-icon fontSet="partIcon" fontIcon="part-circle-remove"></mat-icon>
</button>

<div mat-dialog-content class="dialog-content">

  <div class="report-voting" *ngIf="data?.listing?.isFlagged">
    <div class="text">
      <div class="title">This item has been flagged</div>
      <div *ngIf="data?.listing?.VoteDetails"> 
        <p *ngIf="data?.listing?.VoteDetails?.isReported">You have reported this listing as inappropriate. Voting is enabled for other Particl users for whether to keep it or remove it from the Marketplace.</p>
        <p *ngIf="!data?.listing?.VoteDetails?.isReported">You have already voted on this item &ndash; thanks for participating in community governance!</p>
      </div>
      <div *ngIf="!data?.listing?.VoteDetails">
        <p>A Particl user thinks this item is inappropriate. Please vote on whether this item should be kept online or taken down:</p>

        <button mat-button class="small" color="primary" (click)="voteForListing(data?.listing?.keepItem)">
          <mat-icon fontSet="partIcon" fontIcon="part-thumb-up"></mat-icon>
          It's OK, keep it
        </button>
        <button mat-button class="small" color="warn" (click)="voteForListing(data?.listing?.removeItem)">
          <mat-icon fontSet="partIcon" fontIcon="part-thumb-down"></mat-icon>
          Remove item
        </button>
      </div>
    </div>
  </div><!-- .report-voting -->


  <div class="product" fxLayout="row">

    <div class="product-gallery" fxFlex="1 1 450px">
      <div class="gallery-carousel">
        <img
          *ngIf="data?.listing?.imageCollection?.imageItems?.length === 0"
          [src]="data?.listing?.imageCollection?.featuredImage?.thumbnail">

        <gallery
          *ngIf="data?.listing?.imageCollection?.imageItems?.length"
          gallerize
          [style.height.px]="417"
          [style.width.px]="450"
          [thumbWidth]= "80"
          [thumbHeight]="80"
          [thumb]="data?.listing?.imageCollection?.imageItems?.length > 1"
          [items]="data?.listing?.imageCollection?.imageItems">
        </gallery>
      </div>
    </div><!-- .product-gallery -->

    <div class="product-info" fxFlex="1 1 100%">

      <!--table class="pricing">
        <tr>
          <th class="item price">Price</th>
          <td class="item price">
            <span class="big">{{ data?.listing?.basePrice.getIntegerPart() }}</span><span class="big">{{ data?.listing?.basePrice.dot() }}</span><span class="small">{{ data?.listing?.basePrice.getFractionalPart() }}</span>
            <span class="currency">PART</span>
            <span class="fiat">&asymp; {{price?.usd}} USD</span>
          </td>
        </tr>
        <tr>
          <th class="shipping price">Shipping</th>
          <td class="shipping price">
            International &ndash; {{ data?.listing?.internationalShippingPrice.getAmount() }} PART<br>
            Local in {{ data?.listing?.country }} &ndash; {{ data?.listing?.domesticShippingPrice.getAmount() }} PART
          </td>
        </tr>

        <tr *ngIf="listingServiceCache?.selectedCountry">
          <th class="escrow price">Escrow</th>
          <td class="escrow price">{{ data?.listing?.escrowAmount(listingServiceCache.selectedCountry?.iso)?.getAmount() }} PART</td>
        </tr>
      </table-->

      <div class="pricing" fxLayout fxLayoutAlign="space-between flex-start">

        <div class="item price">
          <div class="title">Price</div>
          <div class="value part">
            <span class="big">{{ data?.listing?.basePrice.getIntegerPart() }}</span><span class="big">{{ data?.listing?.basePrice.dot() }}</span><span class="small">{{ data?.listing?.basePrice.getFractionalPart() }}</span>
            <span class="currency">PART</span>
          </div>
          <div class="value fiat">
            <span class="fiat">~ {{price?.usd}} xx EUR</span>
          </div>
        </div>

        <!--div class="item shipping">
          <div class="title">Shipping</div>
          <table class="shipping-list">
            <tr>
              <th>Worldwide</th>
              <td>{{ data?.listing?.internationalShippingPrice.getAmount() }} PART <span class="fiat">~ 0.41 EUR</span></td>
            </tr>
            <tr>
              <th>Local in {{ data?.listing?.country }}</th>
              <td>{{ data?.listing?.domesticShippingPrice.getAmount() }} PART <span class="fiat">~ 0.41 EUR</span></td>
            </tr>
          </table>
        </div-->

        <!--div class="item escrow">
          <div class="title">Escrow</div>
          <div class="value part">
            {{ data?.listing?.escrowAmount(listingServiceCache.selectedCountry?.iso)?.getAmount() }} PART
          </div>
          <div class="value fiat">
            ~ xx EUR
          </div>
        </div-->

      </div><!-- .pricing -->

      <div class="summary description">
        <p>
          {{ data?.listing?.shortDescription }}
        </p>
      </div>
      
      <div class="detailed description">
        <p>
          {{ data?.listing?.longDescription }}
        </p>
      </div>

      <table class="shipping-escrow">
        <thead>
          <tr>
            <th></th>
            <th>Worldwide</th>
            <th>Local in {{ data?.listing?.country }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th><strong>Shipping</strong></th>
            <td>
              <span class="part price">
                <strong>{{ data?.listing?.internationalShippingPrice.getAmount() }}</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
            <td>
              <span class="part price">
                <strong>{{ data?.listing?.domesticShippingPrice.getAmount() }}</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
          </tr>
          <tr>
            <th>
              <strong>Escrow</strong><br>
              (refunded upon delivery)
            </th>
            <td>
              <span class="part price">
                <strong>{{ data?.listing?.escrowAmount(listingServiceCache.selectedCountry?.iso)?.getAmount() }}</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
            <td>
              <!-- FIXME: "escrow for local (not international)" needs to be implemented: -->
              <span class="part price">
                <strong>{{ data?.listing?.escrowAmount(listingServiceCache.selectedCountry?.iso)?.getAmount() }}</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
          </tr>
          <tr>
            <th>
              <strong>Total needed for order</strong><br>
              (incl. refundable Escrow)
            </th>
            <!-- TODO: price + shipping + escrow -->
            <td>
              <span class="part price">
                <strong>1351.64</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
            <td>
              <span class="part price">
                <strong>1123.15</strong> <small class="currency">PART</small>
              </span>
              <span class="fiat price">
                &asymp; 0.41 <small class="currency">EUR</small>
              </span>
            </td>
          </tr>
        </tbody>
      </table><!-- .shipping-escrow -->

    </div><!-- .product-info -->
  </div><!-- .product -->
</div><!-- .dialog-content -->


<mat-dialog-actions fxLayoutAlign="space-between center">

  <div class="left">
    <app-report *ngIf="!data?.listing?.isFlagged && !data?.listing?.isMine" [listing]="data?.listing" [from]="'preview'"></app-report>
    <div class="date">
      <strong>Date added</strong> {{ data?.listing?.createdAt }}
    </div>
  </div>

  <div class="right" fxLayout fxLayoutAlign="end center">
    <app-favorite [listing]="data?.listing" [detail]="true"></app-favorite>
    <app-add-to-cart [listing]="data?.listing" [detail]="true" (onAdded)="dialogClose()"></app-add-to-cart>

    <!-- if mine, show message instead of "add to cart" button -->
    <button mat-button disabled *ngIf="data?.listing?.isMine">
      <mat-icon fontSet="partIcon" fontIcon="part-circle-info"></mat-icon>
      This is your own listing
    </button>
  </div>

</mat-dialog-actions>
